<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>记一次HTTPS证书过期的处置过程 | 阿钊的写字板 | 公众号：阿钊的写字板</title>

  
  <meta name="author" content="阿钊的写字板">
  

  
  <meta name="description" content="专注于 Java 技术栈与分布式系统实践，分享技术难题攻克、系统优化实战与信创项目开发经验。">
  

  
  <meta name="keywords" content="阿钊的写字板, Java, 分布式">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="记一次HTTPS证书过期的处置过程"/>

  <meta property="og:site_name" content="阿钊的写字板"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="阿钊的写字板" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">阿钊的写字板</a>
    </h1>
    <p class="site-description">专注于 Java 技术栈与分布式系统实践，分享技术难题攻克、系统优化实战与信创项目开发经验。</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">首页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/tags">标签</a></li>
      
        <li><a href="/about">关于我</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>记一次HTTPS证书过期的处置过程</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/posts/ac3d766f.html" rel="bookmark">
        <time class="entry-date published" datetime="2024-10-23T00:12:30.000Z">
          2024-10-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <meta name="referrer" content="no-referrer" />

<span id="more"></span>

<p>记一次 HTTPS 证书过期的处置过程的流水帐。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>因应用上线的需求在阿里云租用了一台服务器，考虑到后期发布的问题一并注册了一个域名。但近期因为项目关系导致该应用的上线时间一直在延期，域名证书因为申请是免费证书（DigiCert RSA）每次只有3个月的有效期，导致证书过期后没有及时更新，在Nginx的网关层<code>HTTP</code>又做了301跳转到<code>HTTP</code>的重定向。导致出现了下面的情况。</p>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410222335262.png" alt="image-20241022233525178"></p>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410222306643.png"></p>
<p>查看签名证书详情我们可以看到，我们证书在10月1日早上8点就失效了，所以导致证书过期。</p>
<h2 id="临时解决方案"><a href="#临时解决方案" class="headerlink" title="临时解决方案"></a>临时解决方案</h2><ol>
<li>解除301重定向</li>
</ol>
<p>由于服务端做了301的跳转，导致网关层接受到的所有 HTTP 请求都会重定向到 HTTPS 。所以这里注释掉<code>return 301</code>的 HTTPS 跳转，并重写 HTTPS 的跳转使 HTTPS 的请求重定向到 HTTP 以解决证书无效的问题。并通过 <u>nginx -s reload</u> 重载nginx配置，使配置生效。此时网站的访问就会恢复正常。</p>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410222330859.png" alt="image-20241022232942746"></p>
<ul>
<li>HTTPS 重定向 HTTP</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">return</span> 301 http://$server_name<span class="variable">$request_uri</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>更新 nginx 配置</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>获取新证书</li>
</ol>
<p>向域名提供商提交申请，签发成功后会有邮件通知。DigiCert RSA 的审核周期预计在5分钟以内。<img src="https://qiniu-image.gotojava.cn/blog/202410222348543.png" alt="image-20241022234835430"></p>
<h2 id="更新证书"><a href="#更新证书" class="headerlink" title="更新证书"></a>更新证书</h2><ul>
<li>获取证书</li>
</ul>
<p>点击下载获取应用的证书文件。根据服务器类型获取对应的证书文件即可。</p>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410222356272.png" alt="image-20241022235602136"></p>
<ul>
<li>部署证书</li>
</ul>
<ol>
<li>将压缩文件解压，将签发的证书文件覆盖上传到对应的证书位置。</li>
</ol>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410222358664.png" alt="image-20241022235859498"></p>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410230003590.png" alt="image-20241023000335484"></p>
<ol start="2">
<li>恢复配置文件的 HTTPS <code>301</code>重定向。</li>
</ol>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410230008287.png" alt="image-20241023000828198"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">return</span> 301 https://$server_name<span class="variable">$request_uri</span>;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用 <code>nginx -s reload</code>重新加载配置文件使配置生效。</li>
</ol>
<ul>
<li>验证</li>
</ul>
<p>页面恢复正常，有效期延长。</p>
<p><img src="https://qiniu-image.gotojava.cn/blog/202410230010654.png" alt="image-20241023001055537"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2025 阿钊的写字板
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>