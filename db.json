{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"source/baidu_urls.txt","path":"baidu_urls.txt","modified":1,"renderable":0},{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"themes/Hacker/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/images/icon-heart.svg","path":"images/icon-heart.svg","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/base/normalize.css","path":"css/base/normalize.css","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/archive.styl","path":"css/components/archive.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/article.styl","path":"css/components/article.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/categories.styl","path":"css/components/categories.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/footer.styl","path":"css/components/footer.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/header.styl","path":"css/components/header.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/icon.styl","path":"css/components/icon.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/layout.styl","path":"css/components/layout.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/pagination.styl","path":"css/components/pagination.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/responsive.styl","path":"css/components/responsive.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/syntax.styl","path":"css/components/syntax.styl","modified":1,"renderable":1},{"_id":"themes/Hacker/source/css/components/tags.styl","path":"css/components/tags.styl","modified":1,"renderable":1}],"Cache":[{"_id":"source/baidu_urls.txt","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1686291058721},{"_id":"source/.DS_Store","hash":"3f0e664e4863b9fbbac02302d1817f1a170ff12d","modified":1689831206014},{"_id":"source/robots.txt","hash":"ee9c89e62577fdc8ef46932136f8766810def1b2","modified":1686287713379},{"_id":"source/_posts/.DS_Store","hash":"66d28333daf352ed5991edb9a6890f905075bd89","modified":1688312755360},{"_id":"source/_posts/Oracle数据库中分页排序问题.md","hash":"53fb4f003123cb1cdd0f645f45a279800c2eaf5a","modified":1689235351571},{"_id":"source/_posts/Windows环境下Oracle数据库的自动备份脚本.md","hash":"ff423f60a3b716dc2f8244d0d252854bf83c235f","modified":1689235376400},{"_id":"source/about/index.md","hash":"95c559551cee616bd79f1185f37372f2f052831e","modified":1686508598291},{"_id":"source/categories/index.md","hash":"cb26ff9cb07386719726a2379152e2425f13b575","modified":1689235801999},{"_id":"source/categories/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1686212234125},{"_id":"source/tags/index.md","hash":"982d1e4b4efbff74995610781a44d817f3027717","modified":1686329000975},{"_id":"themes/Hacker/.DS_Store","hash":"d20d32dec960c0337ae2d1d7faf1f29715cfb23b","modified":1689236043164},{"_id":"themes/Hacker/CHANGELOG.md","hash":"5ee7ae48cc5308758894eb961caaef89ecc04048","modified":1686211730005},{"_id":"themes/Hacker/.gitignore","hash":"c57cf4e0d24c5db09716f924a45ad879650f7548","modified":1686211730005},{"_id":"themes/Hacker/CHANGELOG_zh-CN.md","hash":"5055c0a138469e673b3136c60033c5ae30a32787","modified":1686211730005},{"_id":"themes/Hacker/LICENSE","hash":"3127907a7623734f830e8c69ccee03b693bf993e","modified":1686211730006},{"_id":"themes/Hacker/README.md","hash":"18d28d5466f58f275e0aec504748bbe50f4c62f5","modified":1686211730006},{"_id":"themes/Hacker/languages/default.yml","hash":"d4466fb0a6102e50777ee56957f78de696891a0e","modified":1686211730010},{"_id":"themes/Hacker/_config.yml","hash":"2e881fde4f5d8034e0723ffbbe6628e45ab6b4fd","modified":1689235300618},{"_id":"themes/Hacker/languages/zh-CN.yml","hash":"d822b531c8e0edd5e1ae85ac3de96017e4781b3f","modified":1686211730010},{"_id":"themes/Hacker/layout/.DS_Store","hash":"8dae7881f0d75bf50734c832d09dc3299cf0edc8","modified":1689236577576},{"_id":"themes/Hacker/layout/archive.ejs","hash":"2238cbe29009aafb16969d2c70dceb3f71772123","modified":1686211730011},{"_id":"themes/Hacker/layout/categories.ejs","hash":"bfad4e7eade650c535f0194974e2646619657b8b","modified":1686211730011},{"_id":"themes/Hacker/layout/index.ejs","hash":"1d2c487a95d25e763b5f7e004194eb6ee6b18135","modified":1686211730013},{"_id":"themes/Hacker/layout/layout.ejs","hash":"1bd1ff49fb17548b934e0664ba6cefd60b086fa9","modified":1686211730014},{"_id":"themes/Hacker/layout/page.ejs","hash":"84e00bbcc643dff4bd02880b3bbea658f510835f","modified":1686211730014},{"_id":"themes/Hacker/layout/post.ejs","hash":"84e00bbcc643dff4bd02880b3bbea658f510835f","modified":1686211730014},{"_id":"themes/Hacker/layout/tags.ejs","hash":"ee89e6a9c14bdb5e5e8cf975a558c780fe8dabff","modified":1686211730014},{"_id":"themes/Hacker/source/.DS_Store","hash":"dc4c237626e819b2fa6a586360efc6d80d87a377","modified":1689235898673},{"_id":"themes/Hacker/layout/components/archive.ejs","hash":"1f79ebaf52b8229cf5c58bb8325cf0177859a05c","modified":1686211730012},{"_id":"themes/Hacker/layout/components/article.ejs","hash":"06dd5da86efddecedd26a998fa66c53c580867f0","modified":1686211730012},{"_id":"themes/Hacker/layout/components/baiduanalytics.ejs","hash":"75ea315908beaf390265e00167cf8a30b5d0d94a","modified":1686211730012},{"_id":"themes/Hacker/layout/components/categories.ejs","hash":"3665bf5d1c7181db22dc1c48d62ebf42757d8c27","modified":1686211730012},{"_id":"themes/Hacker/README_zh-CN.md","hash":"c3a7831515835824a51656c74676cf43aa03dc88","modified":1686318169110},{"_id":"themes/Hacker/layout/components/footer.ejs","hash":"fbc80548266d512e9f6c794a115eb9186b9df2e3","modified":1689235604608},{"_id":"themes/Hacker/layout/components/head.ejs","hash":"ccd23eb4394748137f1743a9502d6ed386f85c48","modified":1687103178476},{"_id":"themes/Hacker/layout/components/googleanalytics.ejs","hash":"27e6906523eae89fed4a6e86ebb2ad614a25c647","modified":1686211730013},{"_id":"themes/Hacker/layout/components/header.ejs","hash":"9e7defb12986b7a3261c9791a50900903b729d3e","modified":1686287305529},{"_id":"themes/Hacker/layout/components/pagination.ejs","hash":"4ab5e3b0239e467923a0f91c771bcc9ee7889cfe","modified":1686211730013},{"_id":"themes/Hacker/source/css/style.styl","hash":"208e5f6d010e4e2c5590dae5e4fca8de592d3ef1","modified":1686211730016},{"_id":"themes/Hacker/source/css/.DS_Store","hash":"1111aa1fd00d751bd720aa534c558890885ce2bc","modified":1686318955474},{"_id":"themes/Hacker/source/css/base/normalize.css","hash":"e58275a588bb631a37a2988145eea231ed23176b","modified":1686211730015},{"_id":"themes/Hacker/source/images/icon-heart.svg","hash":"ec483e96c88eea013fd8ac71a34a875107397f43","modified":1686211730017},{"_id":"themes/Hacker/source/css/components/archive.styl","hash":"3ebb7790a46587297966f200fb4fcdbba25269df","modified":1686211730015},{"_id":"themes/Hacker/source/css/components/article.styl","hash":"f613fc6ed4dec8171bf7a03bd8878eaa995082bb","modified":1686211730015},{"_id":"themes/Hacker/source/css/components/categories.styl","hash":"c67e20d60351295cb178b568af42d430f4bcc3e6","modified":1686211730015},{"_id":"themes/Hacker/source/css/components/footer.styl","hash":"80ef890252d31d3bbfe71740fdcfc54ae14cad8e","modified":1686211730015},{"_id":"themes/Hacker/source/css/components/icon.styl","hash":"8da3ff5b6cd1609fdfe0c564d47391367abc8808","modified":1686211730016},{"_id":"themes/Hacker/source/css/components/header.styl","hash":"fa5e6d715d288a327406df78225284c70530cb98","modified":1686211730015},{"_id":"themes/Hacker/source/css/components/layout.styl","hash":"9c6e6bc00f377666f6815bc5e23438893357f8f6","modified":1686211730016},{"_id":"themes/Hacker/source/css/components/pagination.styl","hash":"1cec6cb1835f99432cc5c6ba674782237fea4f95","modified":1686211730016},{"_id":"themes/Hacker/source/css/components/syntax.styl","hash":"8c0d919322194dc295e5404bcd68949f962f88dc","modified":1686211730016},{"_id":"themes/Hacker/source/css/components/responsive.styl","hash":"053e7ec4c22845422440660b7e1d6b0dea5b4fbd","modified":1686211730016},{"_id":"themes/Hacker/layout/components/comment.ejs","hash":"d1fffabbca58cbeb0ff33855fd1b7ea6079e82b3","modified":1686211730012},{"_id":"themes/Hacker/source/css/components/tags.styl","hash":"684cf4eb4b8671476365e955dceebf096cc0e6ed","modified":1686211730016},{"_id":"public/baidu_urls.txt","hash":"02fe724e3dbdec20a2b37bc12b99506d640f577b","modified":1689831366311},{"_id":"public/baidusitemap.xml","hash":"bc95a01f968ae0d30904cc600a08b499d2547fca","modified":1689831366311},{"_id":"public/sitemap.xml","hash":"2b0bea800318779db12254aed118a77efc942072","modified":1689831366311},{"_id":"public/about/index.html","hash":"d0ea8fa3e99c28e69fe7033fe45c50388bbb1bc1","modified":1689831366311},{"_id":"public/tags/index.html","hash":"5ff1e0d2825df38c658df9c34e223ed168588027","modified":1689831366311},{"_id":"public/categories/index.html","hash":"8d9d4c9f2192bbf75f1757353ddf572480602c08","modified":1689831366311},{"_id":"public/2023/06/08/Windows环境下Oracle数据库的自动备份脚本/index.html","hash":"59c849c49e0cc951d26f521cf0f6590e3b2c6b0a","modified":1689831366311},{"_id":"public/2023/06/08/Oracle数据库中分页排序问题/index.html","hash":"08f59eca1fbbbb4785120808f0f11040cf6e0114","modified":1689831366311},{"_id":"public/archives/index.html","hash":"3f66cb77eaf02d3deedb4e4e2f5d6974a8c38087","modified":1689831366311},{"_id":"public/archives/2023/index.html","hash":"d19023ebdaca20f04c3899c4fd089fd9ac331421","modified":1689831366311},{"_id":"public/index.html","hash":"56da5567c7910396571f5be3b33d9ff82566048e","modified":1689831366311},{"_id":"public/tags/Oracle/index.html","hash":"6c899665d7e8241d36780af7044cc72b2c4ace62","modified":1689831366311},{"_id":"public/archives/2023/06/index.html","hash":"3e6f8c56f2470e077d520425eb824e184b338aab","modified":1689831366311},{"_id":"public/categories/数据库/index.html","hash":"020b2fffdc18e8cd589e3f6578b7b4caa0978b3a","modified":1689831366311},{"_id":"public/images/icon-heart.svg","hash":"ec483e96c88eea013fd8ac71a34a875107397f43","modified":1689831366311},{"_id":"public/robots.txt","hash":"ee9c89e62577fdc8ef46932136f8766810def1b2","modified":1689831366311},{"_id":"public/css/components/archive.css","hash":"cea7d6edd8221c00602a799e67046365b2ad929e","modified":1689831366311},{"_id":"public/css/components/article.css","hash":"3a1316dbf86a4f52cf8da789f3a13e94504dee76","modified":1689831366311},{"_id":"public/css/components/categories.css","hash":"f181d27640f1408f032c5386836c4c2322724f8d","modified":1689831366311},{"_id":"public/css/base/normalize.css","hash":"e58275a588bb631a37a2988145eea231ed23176b","modified":1689831366311},{"_id":"public/css/components/footer.css","hash":"602def895fd52f288b6e93932284aa2e52b7fee0","modified":1689831366311},{"_id":"public/css/components/header.css","hash":"51f8a4c736f3b180a7c4c8f804d8060031df6a34","modified":1689831366311},{"_id":"public/css/components/icon.css","hash":"cdaf1a152184ff7def760f14095e4a2fa16cd6bd","modified":1689831366311},{"_id":"public/css/components/pagination.css","hash":"88f7519c0c8ff96b436413528d5f568a4f3d2177","modified":1689831366311},{"_id":"public/css/components/syntax.css","hash":"80de949e0928eb18957f63e7435877085ca626fb","modified":1689831366311},{"_id":"public/css/components/layout.css","hash":"7bffe71c7aba90b2fc5bc6dc1457db50018c7a6f","modified":1689831366311},{"_id":"public/css/components/tags.css","hash":"1566e94c23ae19dbfc7d2cf433e68242ed657dea","modified":1689831366311},{"_id":"public/css/components/responsive.css","hash":"216eb94fc69007de995fc8d382670ba00a9574e8","modified":1689831366311},{"_id":"public/css/style.css","hash":"9be8fa31f5f484cab1cb4fd4752ea15619580271","modified":1689831366311}],"Category":[{"name":"数据库","_id":"clkapyrc30004u2z0fuu393c4"}],"Data":[],"Page":[{"title":"关于我","date":"2023-06-08T04:02:10.000Z","layout":"about","_content":"## 关于我\n\n后端开发工程师\n\n- GitHub：[@澄澈少年](https://github.com/yangzhao917)\n\n- 知乎：[@澄澈少年](https://www.zhihu.com/people/charles-yang-55)\n\n## 朋友们\n\n- [倾旋的博客](https://payloads.online/)\n","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2023-06-08 12:02:10\nlayout: \"about\"\n---\n## 关于我\n\n后端开发工程师\n\n- GitHub：[@澄澈少年](https://github.com/yangzhao917)\n\n- 知乎：[@澄澈少年](https://www.zhihu.com/people/charles-yang-55)\n\n## 朋友们\n\n- [倾旋的博客](https://payloads.online/)\n","updated":"2023-06-11T18:36:38.291Z","path":"about/index.html","comments":1,"_id":"clkapyrbu0000u2z0fglpddkw","content":"<h2 id=\"关于我\"><a href=\"#关于我\" class=\"headerlink\" title=\"关于我\"></a>关于我</h2><p>后端开发工程师</p>\n<ul>\n<li><p>GitHub：<a href=\"https://github.com/yangzhao917\">@澄澈少年</a></p>\n</li>\n<li><p>知乎：<a href=\"https://www.zhihu.com/people/charles-yang-55\">@澄澈少年</a></p>\n</li>\n</ul>\n<h2 id=\"朋友们\"><a href=\"#朋友们\" class=\"headerlink\" title=\"朋友们\"></a>朋友们</h2><ul>\n<li><a href=\"https://payloads.online/\">倾旋的博客</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"关于我\"><a href=\"#关于我\" class=\"headerlink\" title=\"关于我\"></a>关于我</h2><p>后端开发工程师</p>\n<ul>\n<li><p>GitHub：<a href=\"https://github.com/yangzhao917\">@澄澈少年</a></p>\n</li>\n<li><p>知乎：<a href=\"https://www.zhihu.com/people/charles-yang-55\">@澄澈少年</a></p>\n</li>\n</ul>\n<h2 id=\"朋友们\"><a href=\"#朋友们\" class=\"headerlink\" title=\"朋友们\"></a>朋友们</h2><ul>\n<li><a href=\"https://payloads.online/\">倾旋的博客</a></li>\n</ul>\n"},{"title":"标签","date":"2017-01-30T11:16:17.000Z","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2017-01-30 19:16:17\nlayout: \"tags\"\n---\n","updated":"2023-06-09T16:43:20.975Z","path":"tags/index.html","comments":1,"_id":"clkapyrc10002u2z0cwxlakgd","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","date":"2017-01-30T11:16:17.000Z","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2017-01-30 19:16:17\nlayout: \"categories\"\n---","updated":"2023-07-13T08:10:01.999Z","path":"categories/index.html","comments":1,"_id":"clkapyrc50006u2z00zh6ccoi","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Oracle数据库中分页排序问题","date":"2023-06-08T06:00:55.000Z","_content":"<meta name=\"referrer\" content=\"no-referrer\" />\n\n<!--more-->\n\n## 问题复现\n\n- 环境：达梦7\n\n查询SQL如下\n\n```sql\nSELECT\nid,\nduty_date,\nduty_leader,\nduty_leader_id,\nduty_week,\nday_people,\nday_people_id,\nnight_people,\nnight_people_id,\ndriver_people,\nis_work,\nISNULL( ( SELECT COUNT ( id ) FROM T_OA_DUTY_PRINT_LOG WHERE is_print = '1' AND duty_id = t1.id AND created_by = 'a5051dc718b942eb876e967836ec2953' GROUP BY duty_id ), 0 ) AS PRINT_COUNT \nFROM\nT_OA_DUTY_PRINT AS t1 \nWHERE\n1 = 1 \nORDER BY\nSUBSTR ( t1.duty_date, 0, 7 ) DESC,\nduty_date ASC\n```\n\n发现数据库的查询结果数据是正确的\n\n![](https://p.ipic.vip/86usxs.png)\n\n但页面返回的数据排序是有问题的\n\n![](https://p.ipic.vip/0y1d5u.png)\n\n## 问题分析\n\n通过跟踪和调试，发现处理的逻辑拼接了以下代码\n\n![](https://p.ipic.vip/y6xi3a.png)\n\n那么拼接后的SQL就是这样\n\n![](https://p.ipic.vip/gr2ey6.png)\n\n```sql\nSELECT\n\t* \nFROM\n\t(\n\tSELECT\n\t\trownum rn,\n\t\tid,\n\t\tduty_date,\n\t\tduty_leader,\n\t\tduty_leader_id,\n\t\tduty_week,\n\t\tday_people,\n\t\tday_people_id,\n\t\tnight_people,\n\t\tnight_people_id,\n\t\tdriver_people,\n\t\tis_work,\n\t\tISNULL( ( SELECT COUNT ( id ) FROM T_OA_DUTY_PRINT_LOG WHERE is_print = '1' AND duty_id = t1.id AND created_by = 'a5051dc718b942eb876e967836ec2953' GROUP BY duty_id ), 0 ) AS PRINT_COUNT \n\tFROM\n\t\tT_OA_DUTY_PRINT AS t1 \n\tWHERE\n\t\t1 = 1 \n\tORDER BY\n\t\tSUBSTR ( t1.duty_date, 0, 7 ) DESC,\n\t\tduty_date ASC \n\t) template \nWHERE\n\ttemplate.rn> 0 \n\tAND template.rn<= 20\n```\n\n![](https://p.ipic.vip/oqsl8p.png)\n\n也就是查询后的数据的**ROWNUM**的值并没有被重新排序，那么由根据ROWNUM进行分页，数据的排序自然就不对了。\n\n## 解决方式\n\n```sql\nSELECT\n\tROWNUM rn,tmp.*\nFROM\n\t(\n\tSELECT\n\t\tid,\n\t\tduty_date,\n\t\tduty_leader,\n\t\tduty_leader_id,\n\t\tduty_week,\n\t\tday_people,\n\t\tday_people_id,\n\t\tnight_people,\n\t\tnight_people_id,\n\t\tdriver_people,\n\t\tis_work,\n\t\tISNULL( ( SELECT COUNT ( id ) FROM T_OA_DUTY_PRINT_LOG WHERE is_print = '1' AND duty_id = t1.id AND created_by = 'a5051dc718b942eb876e967836ec2953' GROUP BY duty_id ), 0 ) AS PRINT_COUNT \n\tFROM\n\t\tT_OA_DUTY_PRINT AS t1 \n\tWHERE\n\t\t1 = 1 \n\tORDER BY\n\t\tSUBSTR ( t1.duty_date, 0, 7 ) DESC,\n\tduty_date ASC \n\t) AS tmp\n```\n\n![image.png](https://p.ipic.vip/c3flxs.png)\n\n## 参考\n\n`<a href=\"https://blog.csdn.net/github_34013496/article/details/74938788\">`Oracle数据库中分页排序`</a>`\n","source":"_posts/Oracle数据库中分页排序问题.md","raw":"---\ntitle: Oracle数据库中分页排序问题\ndate: 2023-06-08 14:00:55\ncategories: ['数据库']\ntags: ['Oracle']\n---\n<meta name=\"referrer\" content=\"no-referrer\" />\n\n<!--more-->\n\n## 问题复现\n\n- 环境：达梦7\n\n查询SQL如下\n\n```sql\nSELECT\nid,\nduty_date,\nduty_leader,\nduty_leader_id,\nduty_week,\nday_people,\nday_people_id,\nnight_people,\nnight_people_id,\ndriver_people,\nis_work,\nISNULL( ( SELECT COUNT ( id ) FROM T_OA_DUTY_PRINT_LOG WHERE is_print = '1' AND duty_id = t1.id AND created_by = 'a5051dc718b942eb876e967836ec2953' GROUP BY duty_id ), 0 ) AS PRINT_COUNT \nFROM\nT_OA_DUTY_PRINT AS t1 \nWHERE\n1 = 1 \nORDER BY\nSUBSTR ( t1.duty_date, 0, 7 ) DESC,\nduty_date ASC\n```\n\n发现数据库的查询结果数据是正确的\n\n![](https://p.ipic.vip/86usxs.png)\n\n但页面返回的数据排序是有问题的\n\n![](https://p.ipic.vip/0y1d5u.png)\n\n## 问题分析\n\n通过跟踪和调试，发现处理的逻辑拼接了以下代码\n\n![](https://p.ipic.vip/y6xi3a.png)\n\n那么拼接后的SQL就是这样\n\n![](https://p.ipic.vip/gr2ey6.png)\n\n```sql\nSELECT\n\t* \nFROM\n\t(\n\tSELECT\n\t\trownum rn,\n\t\tid,\n\t\tduty_date,\n\t\tduty_leader,\n\t\tduty_leader_id,\n\t\tduty_week,\n\t\tday_people,\n\t\tday_people_id,\n\t\tnight_people,\n\t\tnight_people_id,\n\t\tdriver_people,\n\t\tis_work,\n\t\tISNULL( ( SELECT COUNT ( id ) FROM T_OA_DUTY_PRINT_LOG WHERE is_print = '1' AND duty_id = t1.id AND created_by = 'a5051dc718b942eb876e967836ec2953' GROUP BY duty_id ), 0 ) AS PRINT_COUNT \n\tFROM\n\t\tT_OA_DUTY_PRINT AS t1 \n\tWHERE\n\t\t1 = 1 \n\tORDER BY\n\t\tSUBSTR ( t1.duty_date, 0, 7 ) DESC,\n\t\tduty_date ASC \n\t) template \nWHERE\n\ttemplate.rn> 0 \n\tAND template.rn<= 20\n```\n\n![](https://p.ipic.vip/oqsl8p.png)\n\n也就是查询后的数据的**ROWNUM**的值并没有被重新排序，那么由根据ROWNUM进行分页，数据的排序自然就不对了。\n\n## 解决方式\n\n```sql\nSELECT\n\tROWNUM rn,tmp.*\nFROM\n\t(\n\tSELECT\n\t\tid,\n\t\tduty_date,\n\t\tduty_leader,\n\t\tduty_leader_id,\n\t\tduty_week,\n\t\tday_people,\n\t\tday_people_id,\n\t\tnight_people,\n\t\tnight_people_id,\n\t\tdriver_people,\n\t\tis_work,\n\t\tISNULL( ( SELECT COUNT ( id ) FROM T_OA_DUTY_PRINT_LOG WHERE is_print = '1' AND duty_id = t1.id AND created_by = 'a5051dc718b942eb876e967836ec2953' GROUP BY duty_id ), 0 ) AS PRINT_COUNT \n\tFROM\n\t\tT_OA_DUTY_PRINT AS t1 \n\tWHERE\n\t\t1 = 1 \n\tORDER BY\n\t\tSUBSTR ( t1.duty_date, 0, 7 ) DESC,\n\tduty_date ASC \n\t) AS tmp\n```\n\n![image.png](https://p.ipic.vip/c3flxs.png)\n\n## 参考\n\n`<a href=\"https://blog.csdn.net/github_34013496/article/details/74938788\">`Oracle数据库中分页排序`</a>`\n","slug":"Oracle数据库中分页排序问题","published":1,"updated":"2023-07-13T08:02:31.571Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clkapyrbw0001u2z06grjbekv","content":"<meta name=\"referrer\" content=\"no-referrer\" />\n\n<span id=\"more\"></span>\n\n<h2 id=\"问题复现\"><a href=\"#问题复现\" class=\"headerlink\" title=\"问题复现\"></a>问题复现</h2><ul>\n<li>环境：达梦7</li>\n</ul>\n<p>查询SQL如下</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">id,</span><br><span class=\"line\">duty_date,</span><br><span class=\"line\">duty_leader,</span><br><span class=\"line\">duty_leader_id,</span><br><span class=\"line\">duty_week,</span><br><span class=\"line\">day_people,</span><br><span class=\"line\">day_people_id,</span><br><span class=\"line\">night_people,</span><br><span class=\"line\">night_people_id,</span><br><span class=\"line\">driver_people,</span><br><span class=\"line\">is_work,</span><br><span class=\"line\">ISNULL( ( <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span> ( id ) <span class=\"keyword\">FROM</span> T_OA_DUTY_PRINT_LOG <span class=\"keyword\">WHERE</span> is_print <span class=\"operator\">=</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">AND</span> duty_id <span class=\"operator\">=</span> t1.id <span class=\"keyword\">AND</span> created_by <span class=\"operator\">=</span> <span class=\"string\">&#x27;a5051dc718b942eb876e967836ec2953&#x27;</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> duty_id ), <span class=\"number\">0</span> ) <span class=\"keyword\">AS</span> PRINT_COUNT </span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">T_OA_DUTY_PRINT <span class=\"keyword\">AS</span> t1 </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">SUBSTR ( t1.duty_date, <span class=\"number\">0</span>, <span class=\"number\">7</span> ) <span class=\"keyword\">DESC</span>,</span><br><span class=\"line\">duty_date <span class=\"keyword\">ASC</span></span><br></pre></td></tr></table></figure>\n\n<p>发现数据库的查询结果数据是正确的</p>\n<p><img src=\"https://p.ipic.vip/86usxs.png\"></p>\n<p>但页面返回的数据排序是有问题的</p>\n<p><img src=\"https://p.ipic.vip/0y1d5u.png\"></p>\n<h2 id=\"问题分析\"><a href=\"#问题分析\" class=\"headerlink\" title=\"问题分析\"></a>问题分析</h2><p>通过跟踪和调试，发现处理的逻辑拼接了以下代码</p>\n<p><img src=\"https://p.ipic.vip/y6xi3a.png\"></p>\n<p>那么拼接后的SQL就是这样</p>\n<p><img src=\"https://p.ipic.vip/gr2ey6.png\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\t<span class=\"operator\">*</span> </span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t(</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\t\trownum rn,</span><br><span class=\"line\">\t\tid,</span><br><span class=\"line\">\t\tduty_date,</span><br><span class=\"line\">\t\tduty_leader,</span><br><span class=\"line\">\t\tduty_leader_id,</span><br><span class=\"line\">\t\tduty_week,</span><br><span class=\"line\">\t\tday_people,</span><br><span class=\"line\">\t\tday_people_id,</span><br><span class=\"line\">\t\tnight_people,</span><br><span class=\"line\">\t\tnight_people_id,</span><br><span class=\"line\">\t\tdriver_people,</span><br><span class=\"line\">\t\tis_work,</span><br><span class=\"line\">\t\tISNULL( ( <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span> ( id ) <span class=\"keyword\">FROM</span> T_OA_DUTY_PRINT_LOG <span class=\"keyword\">WHERE</span> is_print <span class=\"operator\">=</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">AND</span> duty_id <span class=\"operator\">=</span> t1.id <span class=\"keyword\">AND</span> created_by <span class=\"operator\">=</span> <span class=\"string\">&#x27;a5051dc718b942eb876e967836ec2953&#x27;</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> duty_id ), <span class=\"number\">0</span> ) <span class=\"keyword\">AS</span> PRINT_COUNT </span><br><span class=\"line\">\t<span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t\tT_OA_DUTY_PRINT <span class=\"keyword\">AS</span> t1 </span><br><span class=\"line\">\t<span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\t\t<span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\">\t<span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">\t\tSUBSTR ( t1.duty_date, <span class=\"number\">0</span>, <span class=\"number\">7</span> ) <span class=\"keyword\">DESC</span>,</span><br><span class=\"line\">\t\tduty_date <span class=\"keyword\">ASC</span> </span><br><span class=\"line\">\t) template </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\ttemplate.rn<span class=\"operator\">&gt;</span> <span class=\"number\">0</span> </span><br><span class=\"line\">\t<span class=\"keyword\">AND</span> template.rn<span class=\"operator\">&lt;=</span> <span class=\"number\">20</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://p.ipic.vip/oqsl8p.png\"></p>\n<p>也就是查询后的数据的<strong>ROWNUM</strong>的值并没有被重新排序，那么由根据ROWNUM进行分页，数据的排序自然就不对了。</p>\n<h2 id=\"解决方式\"><a href=\"#解决方式\" class=\"headerlink\" title=\"解决方式\"></a>解决方式</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\tROWNUM rn,tmp.<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t(</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\t\tid,</span><br><span class=\"line\">\t\tduty_date,</span><br><span class=\"line\">\t\tduty_leader,</span><br><span class=\"line\">\t\tduty_leader_id,</span><br><span class=\"line\">\t\tduty_week,</span><br><span class=\"line\">\t\tday_people,</span><br><span class=\"line\">\t\tday_people_id,</span><br><span class=\"line\">\t\tnight_people,</span><br><span class=\"line\">\t\tnight_people_id,</span><br><span class=\"line\">\t\tdriver_people,</span><br><span class=\"line\">\t\tis_work,</span><br><span class=\"line\">\t\tISNULL( ( <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span> ( id ) <span class=\"keyword\">FROM</span> T_OA_DUTY_PRINT_LOG <span class=\"keyword\">WHERE</span> is_print <span class=\"operator\">=</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">AND</span> duty_id <span class=\"operator\">=</span> t1.id <span class=\"keyword\">AND</span> created_by <span class=\"operator\">=</span> <span class=\"string\">&#x27;a5051dc718b942eb876e967836ec2953&#x27;</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> duty_id ), <span class=\"number\">0</span> ) <span class=\"keyword\">AS</span> PRINT_COUNT </span><br><span class=\"line\">\t<span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t\tT_OA_DUTY_PRINT <span class=\"keyword\">AS</span> t1 </span><br><span class=\"line\">\t<span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\t\t<span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\">\t<span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">\t\tSUBSTR ( t1.duty_date, <span class=\"number\">0</span>, <span class=\"number\">7</span> ) <span class=\"keyword\">DESC</span>,</span><br><span class=\"line\">\tduty_date <span class=\"keyword\">ASC</span> </span><br><span class=\"line\">\t) <span class=\"keyword\">AS</span> tmp</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://p.ipic.vip/c3flxs.png\" alt=\"image.png\"></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><code>&lt;a href=&quot;https://blog.csdn.net/github_34013496/article/details/74938788&quot;&gt;</code>Oracle数据库中分页排序<code>&lt;/a&gt;</code></p>\n","site":{"data":{}},"excerpt":"<meta name=\"referrer\" content=\"no-referrer\" />","more":"<h2 id=\"问题复现\"><a href=\"#问题复现\" class=\"headerlink\" title=\"问题复现\"></a>问题复现</h2><ul>\n<li>环境：达梦7</li>\n</ul>\n<p>查询SQL如下</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">id,</span><br><span class=\"line\">duty_date,</span><br><span class=\"line\">duty_leader,</span><br><span class=\"line\">duty_leader_id,</span><br><span class=\"line\">duty_week,</span><br><span class=\"line\">day_people,</span><br><span class=\"line\">day_people_id,</span><br><span class=\"line\">night_people,</span><br><span class=\"line\">night_people_id,</span><br><span class=\"line\">driver_people,</span><br><span class=\"line\">is_work,</span><br><span class=\"line\">ISNULL( ( <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span> ( id ) <span class=\"keyword\">FROM</span> T_OA_DUTY_PRINT_LOG <span class=\"keyword\">WHERE</span> is_print <span class=\"operator\">=</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">AND</span> duty_id <span class=\"operator\">=</span> t1.id <span class=\"keyword\">AND</span> created_by <span class=\"operator\">=</span> <span class=\"string\">&#x27;a5051dc718b942eb876e967836ec2953&#x27;</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> duty_id ), <span class=\"number\">0</span> ) <span class=\"keyword\">AS</span> PRINT_COUNT </span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">T_OA_DUTY_PRINT <span class=\"keyword\">AS</span> t1 </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\"><span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">SUBSTR ( t1.duty_date, <span class=\"number\">0</span>, <span class=\"number\">7</span> ) <span class=\"keyword\">DESC</span>,</span><br><span class=\"line\">duty_date <span class=\"keyword\">ASC</span></span><br></pre></td></tr></table></figure>\n\n<p>发现数据库的查询结果数据是正确的</p>\n<p><img src=\"https://p.ipic.vip/86usxs.png\"></p>\n<p>但页面返回的数据排序是有问题的</p>\n<p><img src=\"https://p.ipic.vip/0y1d5u.png\"></p>\n<h2 id=\"问题分析\"><a href=\"#问题分析\" class=\"headerlink\" title=\"问题分析\"></a>问题分析</h2><p>通过跟踪和调试，发现处理的逻辑拼接了以下代码</p>\n<p><img src=\"https://p.ipic.vip/y6xi3a.png\"></p>\n<p>那么拼接后的SQL就是这样</p>\n<p><img src=\"https://p.ipic.vip/gr2ey6.png\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\t<span class=\"operator\">*</span> </span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t(</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\t\trownum rn,</span><br><span class=\"line\">\t\tid,</span><br><span class=\"line\">\t\tduty_date,</span><br><span class=\"line\">\t\tduty_leader,</span><br><span class=\"line\">\t\tduty_leader_id,</span><br><span class=\"line\">\t\tduty_week,</span><br><span class=\"line\">\t\tday_people,</span><br><span class=\"line\">\t\tday_people_id,</span><br><span class=\"line\">\t\tnight_people,</span><br><span class=\"line\">\t\tnight_people_id,</span><br><span class=\"line\">\t\tdriver_people,</span><br><span class=\"line\">\t\tis_work,</span><br><span class=\"line\">\t\tISNULL( ( <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span> ( id ) <span class=\"keyword\">FROM</span> T_OA_DUTY_PRINT_LOG <span class=\"keyword\">WHERE</span> is_print <span class=\"operator\">=</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">AND</span> duty_id <span class=\"operator\">=</span> t1.id <span class=\"keyword\">AND</span> created_by <span class=\"operator\">=</span> <span class=\"string\">&#x27;a5051dc718b942eb876e967836ec2953&#x27;</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> duty_id ), <span class=\"number\">0</span> ) <span class=\"keyword\">AS</span> PRINT_COUNT </span><br><span class=\"line\">\t<span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t\tT_OA_DUTY_PRINT <span class=\"keyword\">AS</span> t1 </span><br><span class=\"line\">\t<span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\t\t<span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\">\t<span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">\t\tSUBSTR ( t1.duty_date, <span class=\"number\">0</span>, <span class=\"number\">7</span> ) <span class=\"keyword\">DESC</span>,</span><br><span class=\"line\">\t\tduty_date <span class=\"keyword\">ASC</span> </span><br><span class=\"line\">\t) template </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\ttemplate.rn<span class=\"operator\">&gt;</span> <span class=\"number\">0</span> </span><br><span class=\"line\">\t<span class=\"keyword\">AND</span> template.rn<span class=\"operator\">&lt;=</span> <span class=\"number\">20</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://p.ipic.vip/oqsl8p.png\"></p>\n<p>也就是查询后的数据的<strong>ROWNUM</strong>的值并没有被重新排序，那么由根据ROWNUM进行分页，数据的排序自然就不对了。</p>\n<h2 id=\"解决方式\"><a href=\"#解决方式\" class=\"headerlink\" title=\"解决方式\"></a>解决方式</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\tROWNUM rn,tmp.<span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t(</span><br><span class=\"line\">\t<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">\t\tid,</span><br><span class=\"line\">\t\tduty_date,</span><br><span class=\"line\">\t\tduty_leader,</span><br><span class=\"line\">\t\tduty_leader_id,</span><br><span class=\"line\">\t\tduty_week,</span><br><span class=\"line\">\t\tday_people,</span><br><span class=\"line\">\t\tday_people_id,</span><br><span class=\"line\">\t\tnight_people,</span><br><span class=\"line\">\t\tnight_people_id,</span><br><span class=\"line\">\t\tdriver_people,</span><br><span class=\"line\">\t\tis_work,</span><br><span class=\"line\">\t\tISNULL( ( <span class=\"keyword\">SELECT</span> <span class=\"built_in\">COUNT</span> ( id ) <span class=\"keyword\">FROM</span> T_OA_DUTY_PRINT_LOG <span class=\"keyword\">WHERE</span> is_print <span class=\"operator\">=</span> <span class=\"string\">&#x27;1&#x27;</span> <span class=\"keyword\">AND</span> duty_id <span class=\"operator\">=</span> t1.id <span class=\"keyword\">AND</span> created_by <span class=\"operator\">=</span> <span class=\"string\">&#x27;a5051dc718b942eb876e967836ec2953&#x27;</span> <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> duty_id ), <span class=\"number\">0</span> ) <span class=\"keyword\">AS</span> PRINT_COUNT </span><br><span class=\"line\">\t<span class=\"keyword\">FROM</span></span><br><span class=\"line\">\t\tT_OA_DUTY_PRINT <span class=\"keyword\">AS</span> t1 </span><br><span class=\"line\">\t<span class=\"keyword\">WHERE</span></span><br><span class=\"line\">\t\t<span class=\"number\">1</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> </span><br><span class=\"line\">\t<span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">\t\tSUBSTR ( t1.duty_date, <span class=\"number\">0</span>, <span class=\"number\">7</span> ) <span class=\"keyword\">DESC</span>,</span><br><span class=\"line\">\tduty_date <span class=\"keyword\">ASC</span> </span><br><span class=\"line\">\t) <span class=\"keyword\">AS</span> tmp</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://p.ipic.vip/c3flxs.png\" alt=\"image.png\"></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><code>&lt;a href=&quot;https://blog.csdn.net/github_34013496/article/details/74938788&quot;&gt;</code>Oracle数据库中分页排序<code>&lt;/a&gt;</code></p>"},{"title":"Windows环境下Oracle数据库的自动备份脚本","date":"2023-06-08T06:05:15.000Z","_content":"\n<meta name=\"referrer\" content=\"no-referrer\" />\n\n<!--more-->\n\n## 1.创建批处理文件（.bat）\n\n``` bash\n@echo off   \necho ================================================   \necho  Windows环境下Oracle数据库的自动备份脚本  \necho  1. 使用当前日期命名备份文件。  \necho  2. 自动删除7天前的备份。  \necho ================================================  \n::以“YYYYMMDD”格式取出当前时间。  \nset BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2%  \n::设置用户名、密码和要备份的数据库。  \nset USER=xxx  \nset PASSWORD=123456  \nset DATABASE=dbtest  \n::创建备份目录。  \nif not exist \"D:\\backup\\data\"       mkdir D:\\backup\\data  \nif not exist \"D:\\backup\\log\"        mkdir D:\\backup\\log  \nset DATADIR=D:\\backup\\data  \nset LOGDIR=D:\\backup\\log  \nexp %USER%/%PASSWORD%@%DATABASE%  file=%DATADIR%\\data_%BACKUPDATE%.dmp log=%LOGDIR%\\log_%BACKUPDATE%.log  \n::删除7天前的备份。  \nforfiles /p \"%DATADIR%\" /s /m *.* /d -7 /c \"cmd /c del @path\"  \nforfiles /p \"%LOGDIR%\" /s /m *.* /d -7 /c \"cmd /c del @path\"  \nexit\n```\n\n## 2.添加定时任务执行计划\n\n### 2.1打开任务计划程序\n\n【控制面板】-【管理工具】-【任务计划程序】\n\n### 2.2创建计划任务\n\n![](https://p.ipic.vip/g9lxm9.jpg)\n\n### 2.3选择计划任务的执行循环周期\n\n![](https://p.ipic.vip/l4oxuf.jpg)\n\n### 2.4选择计划任务的执行时间\n\n![](https://p.ipic.vip/v0l07u.jpg)\n\n### 2.5选择程序位置\n\n![](https://p.ipic.vip/28gm9z.jpg)\n\n![](https://p.ipic.vip/puyk76.jpg)\n\n### 2.6确认任务摘要\n\n![](https://p.ipic.vip/dyq03q.jpg)\n\n> 点击“完成”，完成定时任务的创建。\n\n## 参考\n\n- <a href=\"https://www.cnblogs.com/johnhery/p/9941963.html\">%date~0,4%和 %time~0,2%等用法详解</a>\n- <a href=\"https://www.cnblogs.com/login2012/p/5794572.html\">Windows环境下Oracle数据库的自动备份脚本</a>\n- <a href=\"https://blog.csdn.net/YBaog/article/details/100023073\">Windows Server 2012 / 2016 定时任务设置和无法执行的解决方法</a>\n\n","source":"_posts/Windows环境下Oracle数据库的自动备份脚本.md","raw":"---\ntitle: Windows环境下Oracle数据库的自动备份脚本\ndate: 2023-06-08 14:05:15\ncategories: ['数据库']\ntags: ['Oracle']\n---\n\n<meta name=\"referrer\" content=\"no-referrer\" />\n\n<!--more-->\n\n## 1.创建批处理文件（.bat）\n\n``` bash\n@echo off   \necho ================================================   \necho  Windows环境下Oracle数据库的自动备份脚本  \necho  1. 使用当前日期命名备份文件。  \necho  2. 自动删除7天前的备份。  \necho ================================================  \n::以“YYYYMMDD”格式取出当前时间。  \nset BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2%  \n::设置用户名、密码和要备份的数据库。  \nset USER=xxx  \nset PASSWORD=123456  \nset DATABASE=dbtest  \n::创建备份目录。  \nif not exist \"D:\\backup\\data\"       mkdir D:\\backup\\data  \nif not exist \"D:\\backup\\log\"        mkdir D:\\backup\\log  \nset DATADIR=D:\\backup\\data  \nset LOGDIR=D:\\backup\\log  \nexp %USER%/%PASSWORD%@%DATABASE%  file=%DATADIR%\\data_%BACKUPDATE%.dmp log=%LOGDIR%\\log_%BACKUPDATE%.log  \n::删除7天前的备份。  \nforfiles /p \"%DATADIR%\" /s /m *.* /d -7 /c \"cmd /c del @path\"  \nforfiles /p \"%LOGDIR%\" /s /m *.* /d -7 /c \"cmd /c del @path\"  \nexit\n```\n\n## 2.添加定时任务执行计划\n\n### 2.1打开任务计划程序\n\n【控制面板】-【管理工具】-【任务计划程序】\n\n### 2.2创建计划任务\n\n![](https://p.ipic.vip/g9lxm9.jpg)\n\n### 2.3选择计划任务的执行循环周期\n\n![](https://p.ipic.vip/l4oxuf.jpg)\n\n### 2.4选择计划任务的执行时间\n\n![](https://p.ipic.vip/v0l07u.jpg)\n\n### 2.5选择程序位置\n\n![](https://p.ipic.vip/28gm9z.jpg)\n\n![](https://p.ipic.vip/puyk76.jpg)\n\n### 2.6确认任务摘要\n\n![](https://p.ipic.vip/dyq03q.jpg)\n\n> 点击“完成”，完成定时任务的创建。\n\n## 参考\n\n- <a href=\"https://www.cnblogs.com/johnhery/p/9941963.html\">%date~0,4%和 %time~0,2%等用法详解</a>\n- <a href=\"https://www.cnblogs.com/login2012/p/5794572.html\">Windows环境下Oracle数据库的自动备份脚本</a>\n- <a href=\"https://blog.csdn.net/YBaog/article/details/100023073\">Windows Server 2012 / 2016 定时任务设置和无法执行的解决方法</a>\n\n","slug":"Windows环境下Oracle数据库的自动备份脚本","published":1,"updated":"2023-07-13T08:02:56.400Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clkapyrc10003u2z0e6qob4kt","content":"<meta name=\"referrer\" content=\"no-referrer\" />\n\n<span id=\"more\"></span>\n\n<h2 id=\"1-创建批处理文件（-bat）\"><a href=\"#1-创建批处理文件（-bat）\" class=\"headerlink\" title=\"1.创建批处理文件（.bat）\"></a>1.创建批处理文件（.bat）</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off   </span><br><span class=\"line\"><span class=\"built_in\">echo</span> ================================================   </span><br><span class=\"line\"><span class=\"built_in\">echo</span>  Windows环境下Oracle数据库的自动备份脚本  </span><br><span class=\"line\"><span class=\"built_in\">echo</span>  1. 使用当前日期命名备份文件。  </span><br><span class=\"line\"><span class=\"built_in\">echo</span>  2. 自动删除7天前的备份。  </span><br><span class=\"line\"><span class=\"built_in\">echo</span> ================================================  </span><br><span class=\"line\">::以“YYYYMMDD”格式取出当前时间。  </span><br><span class=\"line\"><span class=\"built_in\">set</span> BACKUPDATE=%<span class=\"built_in\">date</span>:~0,4%%<span class=\"built_in\">date</span>:~5,2%%<span class=\"built_in\">date</span>:~8,2%  </span><br><span class=\"line\">::设置用户名、密码和要备份的数据库。  </span><br><span class=\"line\"><span class=\"built_in\">set</span> USER=xxx  </span><br><span class=\"line\"><span class=\"built_in\">set</span> PASSWORD=123456  </span><br><span class=\"line\"><span class=\"built_in\">set</span> DATABASE=dbtest  </span><br><span class=\"line\">::创建备份目录。  </span><br><span class=\"line\"><span class=\"keyword\">if</span> not exist <span class=\"string\">&quot;D:\\backup\\data&quot;</span>       <span class=\"built_in\">mkdir</span> D:\\backup\\data  </span><br><span class=\"line\"><span class=\"keyword\">if</span> not exist <span class=\"string\">&quot;D:\\backup\\log&quot;</span>        <span class=\"built_in\">mkdir</span> D:\\backup\\<span class=\"built_in\">log</span>  </span><br><span class=\"line\"><span class=\"built_in\">set</span> DATADIR=D:\\backup\\data  </span><br><span class=\"line\"><span class=\"built_in\">set</span> LOGDIR=D:\\backup\\<span class=\"built_in\">log</span>  </span><br><span class=\"line\">exp %USER%/%PASSWORD%@%DATABASE%  file=%DATADIR%\\data_%BACKUPDATE%.dmp <span class=\"built_in\">log</span>=%LOGDIR%\\log_%BACKUPDATE%.<span class=\"built_in\">log</span>  </span><br><span class=\"line\">::删除7天前的备份。  </span><br><span class=\"line\">forfiles /p <span class=\"string\">&quot;%DATADIR%&quot;</span> /s /m *.* /d -7 /c <span class=\"string\">&quot;cmd /c del @path&quot;</span>  </span><br><span class=\"line\">forfiles /p <span class=\"string\">&quot;%LOGDIR%&quot;</span> /s /m *.* /d -7 /c <span class=\"string\">&quot;cmd /c del @path&quot;</span>  </span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-添加定时任务执行计划\"><a href=\"#2-添加定时任务执行计划\" class=\"headerlink\" title=\"2.添加定时任务执行计划\"></a>2.添加定时任务执行计划</h2><h3 id=\"2-1打开任务计划程序\"><a href=\"#2-1打开任务计划程序\" class=\"headerlink\" title=\"2.1打开任务计划程序\"></a>2.1打开任务计划程序</h3><p>【控制面板】-【管理工具】-【任务计划程序】</p>\n<h3 id=\"2-2创建计划任务\"><a href=\"#2-2创建计划任务\" class=\"headerlink\" title=\"2.2创建计划任务\"></a>2.2创建计划任务</h3><p><img src=\"https://p.ipic.vip/g9lxm9.jpg\"></p>\n<h3 id=\"2-3选择计划任务的执行循环周期\"><a href=\"#2-3选择计划任务的执行循环周期\" class=\"headerlink\" title=\"2.3选择计划任务的执行循环周期\"></a>2.3选择计划任务的执行循环周期</h3><p><img src=\"https://p.ipic.vip/l4oxuf.jpg\"></p>\n<h3 id=\"2-4选择计划任务的执行时间\"><a href=\"#2-4选择计划任务的执行时间\" class=\"headerlink\" title=\"2.4选择计划任务的执行时间\"></a>2.4选择计划任务的执行时间</h3><p><img src=\"https://p.ipic.vip/v0l07u.jpg\"></p>\n<h3 id=\"2-5选择程序位置\"><a href=\"#2-5选择程序位置\" class=\"headerlink\" title=\"2.5选择程序位置\"></a>2.5选择程序位置</h3><p><img src=\"https://p.ipic.vip/28gm9z.jpg\"></p>\n<p><img src=\"https://p.ipic.vip/puyk76.jpg\"></p>\n<h3 id=\"2-6确认任务摘要\"><a href=\"#2-6确认任务摘要\" class=\"headerlink\" title=\"2.6确认任务摘要\"></a>2.6确认任务摘要</h3><p><img src=\"https://p.ipic.vip/dyq03q.jpg\"></p>\n<blockquote>\n<p>点击“完成”，完成定时任务的创建。</p>\n</blockquote>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://www.cnblogs.com/johnhery/p/9941963.html\">%date<del>0,4%和 %time</del>0,2%等用法详解</a></li>\n<li><a href=\"https://www.cnblogs.com/login2012/p/5794572.html\">Windows环境下Oracle数据库的自动备份脚本</a></li>\n<li><a href=\"https://blog.csdn.net/YBaog/article/details/100023073\">Windows Server 2012 &#x2F; 2016 定时任务设置和无法执行的解决方法</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<meta name=\"referrer\" content=\"no-referrer\" />","more":"<h2 id=\"1-创建批处理文件（-bat）\"><a href=\"#1-创建批处理文件（-bat）\" class=\"headerlink\" title=\"1.创建批处理文件（.bat）\"></a>1.创建批处理文件（.bat）</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off   </span><br><span class=\"line\"><span class=\"built_in\">echo</span> ================================================   </span><br><span class=\"line\"><span class=\"built_in\">echo</span>  Windows环境下Oracle数据库的自动备份脚本  </span><br><span class=\"line\"><span class=\"built_in\">echo</span>  1. 使用当前日期命名备份文件。  </span><br><span class=\"line\"><span class=\"built_in\">echo</span>  2. 自动删除7天前的备份。  </span><br><span class=\"line\"><span class=\"built_in\">echo</span> ================================================  </span><br><span class=\"line\">::以“YYYYMMDD”格式取出当前时间。  </span><br><span class=\"line\"><span class=\"built_in\">set</span> BACKUPDATE=%<span class=\"built_in\">date</span>:~0,4%%<span class=\"built_in\">date</span>:~5,2%%<span class=\"built_in\">date</span>:~8,2%  </span><br><span class=\"line\">::设置用户名、密码和要备份的数据库。  </span><br><span class=\"line\"><span class=\"built_in\">set</span> USER=xxx  </span><br><span class=\"line\"><span class=\"built_in\">set</span> PASSWORD=123456  </span><br><span class=\"line\"><span class=\"built_in\">set</span> DATABASE=dbtest  </span><br><span class=\"line\">::创建备份目录。  </span><br><span class=\"line\"><span class=\"keyword\">if</span> not exist <span class=\"string\">&quot;D:\\backup\\data&quot;</span>       <span class=\"built_in\">mkdir</span> D:\\backup\\data  </span><br><span class=\"line\"><span class=\"keyword\">if</span> not exist <span class=\"string\">&quot;D:\\backup\\log&quot;</span>        <span class=\"built_in\">mkdir</span> D:\\backup\\<span class=\"built_in\">log</span>  </span><br><span class=\"line\"><span class=\"built_in\">set</span> DATADIR=D:\\backup\\data  </span><br><span class=\"line\"><span class=\"built_in\">set</span> LOGDIR=D:\\backup\\<span class=\"built_in\">log</span>  </span><br><span class=\"line\">exp %USER%/%PASSWORD%@%DATABASE%  file=%DATADIR%\\data_%BACKUPDATE%.dmp <span class=\"built_in\">log</span>=%LOGDIR%\\log_%BACKUPDATE%.<span class=\"built_in\">log</span>  </span><br><span class=\"line\">::删除7天前的备份。  </span><br><span class=\"line\">forfiles /p <span class=\"string\">&quot;%DATADIR%&quot;</span> /s /m *.* /d -7 /c <span class=\"string\">&quot;cmd /c del @path&quot;</span>  </span><br><span class=\"line\">forfiles /p <span class=\"string\">&quot;%LOGDIR%&quot;</span> /s /m *.* /d -7 /c <span class=\"string\">&quot;cmd /c del @path&quot;</span>  </span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-添加定时任务执行计划\"><a href=\"#2-添加定时任务执行计划\" class=\"headerlink\" title=\"2.添加定时任务执行计划\"></a>2.添加定时任务执行计划</h2><h3 id=\"2-1打开任务计划程序\"><a href=\"#2-1打开任务计划程序\" class=\"headerlink\" title=\"2.1打开任务计划程序\"></a>2.1打开任务计划程序</h3><p>【控制面板】-【管理工具】-【任务计划程序】</p>\n<h3 id=\"2-2创建计划任务\"><a href=\"#2-2创建计划任务\" class=\"headerlink\" title=\"2.2创建计划任务\"></a>2.2创建计划任务</h3><p><img src=\"https://p.ipic.vip/g9lxm9.jpg\"></p>\n<h3 id=\"2-3选择计划任务的执行循环周期\"><a href=\"#2-3选择计划任务的执行循环周期\" class=\"headerlink\" title=\"2.3选择计划任务的执行循环周期\"></a>2.3选择计划任务的执行循环周期</h3><p><img src=\"https://p.ipic.vip/l4oxuf.jpg\"></p>\n<h3 id=\"2-4选择计划任务的执行时间\"><a href=\"#2-4选择计划任务的执行时间\" class=\"headerlink\" title=\"2.4选择计划任务的执行时间\"></a>2.4选择计划任务的执行时间</h3><p><img src=\"https://p.ipic.vip/v0l07u.jpg\"></p>\n<h3 id=\"2-5选择程序位置\"><a href=\"#2-5选择程序位置\" class=\"headerlink\" title=\"2.5选择程序位置\"></a>2.5选择程序位置</h3><p><img src=\"https://p.ipic.vip/28gm9z.jpg\"></p>\n<p><img src=\"https://p.ipic.vip/puyk76.jpg\"></p>\n<h3 id=\"2-6确认任务摘要\"><a href=\"#2-6确认任务摘要\" class=\"headerlink\" title=\"2.6确认任务摘要\"></a>2.6确认任务摘要</h3><p><img src=\"https://p.ipic.vip/dyq03q.jpg\"></p>\n<blockquote>\n<p>点击“完成”，完成定时任务的创建。</p>\n</blockquote>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"https://www.cnblogs.com/johnhery/p/9941963.html\">%date<del>0,4%和 %time</del>0,2%等用法详解</a></li>\n<li><a href=\"https://www.cnblogs.com/login2012/p/5794572.html\">Windows环境下Oracle数据库的自动备份脚本</a></li>\n<li><a href=\"https://blog.csdn.net/YBaog/article/details/100023073\">Windows Server 2012 &#x2F; 2016 定时任务设置和无法执行的解决方法</a></li>\n</ul>"}],"PostAsset":[],"PostCategory":[{"post_id":"clkapyrbw0001u2z06grjbekv","category_id":"clkapyrc30004u2z0fuu393c4","_id":"clkapyrc8000au2z0ahrtc7rj"},{"post_id":"clkapyrc10003u2z0e6qob4kt","category_id":"clkapyrc30004u2z0fuu393c4","_id":"clkapyrc9000cu2z0dpebgti0"}],"PostTag":[{"post_id":"clkapyrbw0001u2z06grjbekv","tag_id":"clkapyrc50005u2z01f089y41","_id":"clkapyrc80009u2z03qructc8"},{"post_id":"clkapyrc10003u2z0e6qob4kt","tag_id":"clkapyrc50005u2z01f089y41","_id":"clkapyrc8000bu2z078bsekkt"}],"Tag":[{"name":"Oracle","_id":"clkapyrc50005u2z01f089y41"}]}}